<html>
<head>
<title>Arabic Keyboard</title>
<meta name="description" content="online editor to write Arabic, especially for transcribing manuscripts and composing regular expressions. Based on Ahmad Ismail's Arabic keyboard at http://www.arabic-keyboard.org/">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="css/v2.css?13">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js" type="text/javascript"></script>
<script src="jscript/prototype.js?13" type="text/javascript"></script>

</head>

<body style="">

<div id="intro">
    <h1>Arabic keyboard</h1>
    <button class="btn l-btn" onclick="copy2Clipboard()">Copy to clipboard</button>

    <div class="rgxChckbx" id="rgxChckbx0">
        <div class="tooltip">
            Regex mode
            <span class="tooltiptext">Use this mode for writing regular expressions</span>
        </div>
        : 
        <input type="checkbox" id="regexCheck0">
    </div>
    <div class="rgxChckbx" id="rgxChckbx">
        <div class="tooltip">
            Separate Arabic letters
            <span class="tooltiptext">By checking this checkbox, the Arabic letters you input will be displayed as separated by an invisible space;
            if you click the "Copy to Clipboard" button, however, the text will be copied without these separators</span>
        </div>
        : 
        <input type="checkbox" id="regexCheck">
    </div>
</div>


<div id="keyboard">
    <div>
        <span>
            <textarea id="area" dir="rtl" name="area" tabindex="1" onkeyup="insertALM()"></textarea>
        </span>
    </div>
    <div id="keyboardPic">
        <img id="k" src="i/keyboard_basic.png" usemap="#key" alt="" width="450" height="256" border="0"> 
    </div>
</div>

<div id="extraRows">
    <div class="extraRow" id="extraRow0">
        <!-- 
            <div class="rowBgd">
                <img src="i/emptyKeyRow_45x450.png" height="45px" width="450px"></img>
            </div>
            <div class="keyGrid">
                <div class="keyCharacter">ک</div>
            </div>
            <div class="rowMapped">
                <img src="i/emptyKeyRow_45x450.png" height="45px" width="450px"></img>
            </div>
         -->
    </div>
</div>
<div>
    <button class="btn" onclick="Toggle('cheatsheet')">Toggle Regex Cheatsheet input</button>
</div>
<div id="addNewKeyInput">
    <h3>Need more special characters? </h3>
    <p>Add a key with a new character (and an optional description):</p>
    <input type="text" class="extraInput" id="extraInput0" dir="rtl" value="ک"></input>
    <input type="text" class="extraInputDescr" id="extraInputDescr0" value="description"></input>
    <button class="fivePxMargin" onclick='addKey("none", "none")'>add key</button>
</div>
<div>
    <div id="cheatsheet">
        <h4>Regex Cheatsheet input (<a href="https://www.rexegg.com/regex-quickstart.html" target="_blank">source</a>)</h4>
        <!-- 
            <img src="i/regexCheatSheet.jpg"></img>
            -->
        
        <table>
            <tr><td></td><td></td><td><b>Sample regex</b></td><td><b>Sample match</b></td></tr>
            <tr><td><button class="regexInput" onclick="wr('.')">.</button></td><td>Any character except line break</td><td>a.c</td><td><b>abc a.c</b></td></tr>
            <tr><td><button class="regexInput" onclick="wr('\')">\</button></td><td>Escapes a special character</td><td>a\.c</td><td>abc <b>a.c</b></td></tr>
        </table>
        <div class="regexTitle" onclick="Toggle('charGroups')">Character groups &or;</div>
        <div class="regexClass" id="charGroups">
            <table>
                <tr><td><button class="regexInput" onclick="wr('\d')">\d</button></td><td>one Unicode digit in any script</td><td>file_\d_\d</td><td><b>file_9_ ٩</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('\w')">\w</button></td><td>"word character": Unicode letter, ideogram, digit, or underscore</td><td>\w-\w\w\w</td><td><b>字-ま_۳</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('\s')">\s</button></td><td>"whitespace character": any Unicode separator</td><td>a\sb\sc</td><td>aaa<b>a b
                    c</b>ccdde</td></tr>
                <tr><td><button class="regexInput" onclick="wr('\D')">\D</button></td><td>One character that is not a digit</td><td>2\D\D\D</td><td>1<b>2ABC</b>34</td></tr>
                <tr><td><button class="regexInput" onclick="wr('\W')">\W</button></td><td>One character that is not a word character</td><td>\W\W\W\W\W</td><td><b>*-+=)</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('\S')">\S</button></td><td>One character that is not a whitespace character</td><td>\S\S\S\S</td><td><b>Yo3) </b> Y o3</td></tr>
            </table>
        </div>
        <div class="regexTitle" onclick="Toggle('whiteSpace')">More White-Space &or;</div>
        <div class="regexClass" id="whiteSpace">
            <table>
                <tr><td><button class="regexInput" onclick="wr('\t')">\t</button></td><td>Tab</td><td>T\t\w\w</td><td>A <b>T     ab</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('\r')">\r</button></td><td>Carriage return character</td><td>see below</td><td></td></tr>
                <tr><td><button class="regexInput" onclick="wr('\n')">\n</button></td><td>Line feed character</td><td>see below</td><td></td></tr>
                <tr><td><button class="regexInput" onclick="wr('\r\n')">\r\n</button></td><td>Line separator on Windows</td><td>AB\r\nCD</td><td><b>AB<br/>CD</b></td></tr>
            </table>
        </div>
        <div class="regexTitle" onclick="Toggle('quantifiers')">Quantifiers &or;</div>
        <div class="regexClass" id="quantifiers">
            <table>
                <tr><td><button class="regexInput" onclick="wr('?')">?</button></td><td>Once or none</td><td>plurals?</td><td><b>plural</b> and <b>plurals</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('*')">*</button></td><td>Zero or more times (greedy) </td><td>aB*a bB*b aB*</td><td><b>aBBa bb aBBBBB</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('+')">+</button></td><td>One or more (greedy) </td><td>Version \w-\w+</td><td><b>Version A-b1_100</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('{}')">{3}</button></td><td>Exactly three times</td><td>\D{3}</td><td><b>ABC</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('{,}')">{2,4}</button></td><td>Two to four times (greedy) </td><td>\d{2,4}</td><td><b>156</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('{,}')">{3,}</button></td><td>Three or more times (greedy) </td><td>\w{4,}</td><td><b>regex_</b></td></tr>
            </table>
        </div>
        <div class="regexTitle" onclick="Toggle('lazyQuantifiers')">Lazy quantifiers (w/ question mark) &or;</div>
        <div class="regexClass" id="lazyQuantifiers">
            <table>
                <tr><td><button class="regexInput" onclick="wr('+?')">+?</button></td><td>One or more (lazy) </td><td>Version \w-\w+?</td><td><b>Version A-b1_1</b>00</td></tr>
                <tr><td><button class="regexInput" onclick="wr('{,}?')">{2,4}?</button></td><td>Two to four times (lazy) </td><td>\d{2,4}?</td><td><b>15</b>6</td></tr>
                <tr><td><button class="regexInput" onclick="wr('{,}?')">{3,}?</button></td><td>Three or more times (lazy) </td><td>\w{4,}?</td><td><b>rege</b>x_</td></tr>
                <tr><td><button class="regexInput" onclick="wr('*?')">*?</button></td><td>Zero or more times (lazy) </td><td>a\d*?a b\d*?b a\d*?</td><td><b>aBBa bb a</b>BBBBB</td></tr>
            </table>
        </div>
        <div class="regexTitle" onclick="Toggle('logic')">Logic &or;</div>
        <div class="regexClass" id="logic">
            <table>
                <tr><td><button class="regexInput" onclick="wr('|')">|</button></td><td>Alternation / OR operand</td><td>22|33</td><td><b>22</b> + 11 = <b>33</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('()')">( … )</button></td><td>Capturing group</td><td>A(nt|pple)</td><td>An <b>A<span class="underline">nt</span></b> on an <b>A<span class="underline">pple</span></b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('\1')">\1</button></td><td>Contents of Group 1</td><td>r(\w)g\1x</td><td><b>regex</b> not rigex</td></tr>
                <tr><td><button class="regexInput" onclick="wr('\2')">\2</button></td><td>Contents of Group 2</td><td>(\d\d)\+(\d\d)=\2\+\1</td><td><b>12+65=65+12</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('(?:)')">(?: … )</button></td><td>Non-capturing group</td><td>A(?:nt|pple)</td><td>An <b>Ant</b> on an <b>Apple</b></td></tr>
            </table>
        </div>
        <div class="regexTitle" onclick="Toggle('charClasses')">Character Classes &or;</div>
        <div class="regexClass" id="charClasses">
            <table>
                <tr><td><button class="regexInput" onclick="wr('[]')">[ … ]</button></td><td>One of the characters in the brackets</td><td>T[ao]p</td><td><b>Tap</b> and <b>Top</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('[-]')">[x-y]</button></td><td>One of the characters in the range from x to y</td><td>[A-Z]+</td><td><b>UPPER</b>case <b>LE</b>tter<b>S</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('[^]')">[^xy]</button></td><td>One character that is not x or y</td><td>[^12]</td><td><b>A</b>1<b>b</b>2<b>+</b>1</td></tr>
                <tr><td><button class="regexInput" onclick="wr('[^-]')">[^x-y]</button></td><td>One of the characters not in the range from x to y</td><td>[^a-z]{3}</td><td>ab<b>A1! </b>cd</td></tr>
            </table>
        </div>
        <div class="regexTitle" onclick="Toggle('anchors')">Anchors and Boundaries &or;</div>
        <div class="regexClass" id="anchors">
            <table>
                <tr><td><button class="regexInput" onclick="wr('^')">^</button></td><td>Start of line</td><td>^abc [1-9]*</td><td><b>abc 18</b> abc 19</td></tr>
                <tr><td><button class="regexInput" onclick="wr('$')">$</button></td><td>End of line</td><td>abc [1-9]*$</td><td>abc 18 <b>abc 19</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('\b')">\b</button></td><td>Word boundary: position where one side only is a letter, digit or underscore</td><td>\bكتب\b</td><td><b>كتب</b> مكتبه كتبه</td></tr>
                <tr><td><button class="regexInput" onclick="wr('\B')">\B</button></td><td>Not a word boundary</td><td>\S*\Bكتب\B\S*</td><td>كتب <b>مكتبه</b> كتبه</td></tr>
            </table>
        </div>
        <div class="regexTitle" onclick="Toggle('lookarounds')">Lookarounds &or;</div>
        <div class="regexClass" id="lookarounds">
            <table>
                <tr><td><button class="regexInput" onclick="wr('(?=)')">(?=…)</button></td><td>Positive lookahead</td><td>(?=\d{10})\d{5}</td><td><b>01234</b>56789</td></tr>
                <tr><td><button class="regexInput" onclick="wr('(?\u3008=)')">(?&lt;=…)</button></td><td>Positive lookbehind</td><td>(?&lt;=\d) cat</td><td>1 <b>cat</b> white cat</td></tr>
                <tr><td><button class="regexInput" onclick="wr('(?!)')">(?!…)</button></td><td>Negative lookahead</td><td>(?!theatre)the\w*</td><td><b>the</b> theatre <b>theme</b></td></tr>
                <tr><td><button class="regexInput" onclick="wr('(?\u3008!)')">(?&lt;!…)</button></td><td>Negative lookbehind</td><td>(?&lt;!USD)\d{3,}</td><td>USD300 = GBP<b>250</b></td></tr>
            </table>
        </div>
        <div class="regexTitle" onclick="Toggle('arabic')">Arabic Unicode &or;</div>
        <div class="regexClass" id="arabic">
            <table>
                <tr><td><button class="regexInput" onclick="wr('[\u0600-\u06ff\u08a0-\u08ff\ufb50-\ufdff\ufe70-\ufeff]')"></button></td><td>Any Arabic character in Unicode </td><td></td><td></td></tr>
                <tr><td><button class="regexInput" onclick="wr('[،؍؎؏؛؞؟٭۔۝۞۩۽]')"></button></td><td>Any Arabic punctuation character in Unicode</td><td></td><td></td></tr>
                <tr><td><button class="regexInput" onclick="wr('[\u25cc\u0610-\u25cc\u061A\u25cc\u064b-\u25cc\u065f\u25cc\u0670\u25cc\u06d6-\u25cc\u06dc\u25cc\u06df-\u25cc\u06e4\u25cc\u06e7\u25cc\u06e8\u25cc\u06ea-\u25cc\u06ed]')"></button></td><td>Any Arabic diacritic in Unicode</td><td></td><td></td></tr>
                <tr><td><button class="regexInput" onclick="wr('[\u0660-\u0669\u06f0-\u06f9]')"></button></td><td>Any Arabic/hindi number in Unicode</td><td></td><td></td></tr>
            </table>
        </div>
    </div>
</div>

<div id="links">
    <h3>Useful links</h3>
    <p>For finding Unicode characters by name, with easy copying:</p>
    <ul>
      <li><a href="https://unicode-table.com/en" target="_blank">https://unicode-table.com/en</a></li>
    </ul>
    <p>For inspecting Unicode code points of a text: </p>
    <ul>
      <li><a href="http://www.babelstone.co.uk/Unicode/whatisit.html" target="_blank">http://www.babelstone.co.uk/Unicode/whatisit.html</a></li>
      <li><a href="https://apps.timwhitlock.info/unicode/inspect" target="_blank">https://apps.timwhitlock.info/unicode/inspect</a></li>
      <li><a href="https://r12a.github.io/uniview" target="_blank">https://r12a.github.io/uniview</a></li>
    </ul>
    <p>Unicode blocks related to Arabic:</p> 
    <ul>
      <li><a href="http://www.unicode-symbol.com/block/Arabic.html" target="_blank">Unicode code block "Arabic"</a></li>
      <li><a href="http://www.unicode-symbol.com/block/Arabic_Ext_A.html" target="_blank">Unicode code block "Arabic Extended-A"</a></li>
      <li><a href="http://www.unicode-symbol.com/block/Arabic_Math.html" target="_blank">Unicode code block "Arabic Mathematical Symbols"</a></li>
      <li><a href="http://www.unicode-symbol.com/block/Arabic_PF_A.html" target="_blank">Unicode code block "Arabic Presentation Forms A"</a></li>
      <li><a href="http://www.unicode-symbol.com/block/Arabic_PF_B.html" target="_blank">Unicode code block "Arabic Presentation Forms B"</a></li>
      <li><a href="http://www.unicode-symbol.com/block/Arabic_Sup.html" target="_blank">Unicode code block "Arabic Supplement"</a></li>
    </ul>
</div>

<p class="footer">This keyboard is an adaptation of Ahmad Ismail's <a href="http://www.arabic-keyboard.org/" target="_blank">Arabic keyboard</a> to the needs of researchers working with Arabic palaeography and regular expressions.</p>

<map name="key">
 <area shape="rect" coords="4,4,35,35" onclick="wr('ذ')" alt="">
 <area shape="rect" coords="35,4,64,32" onclick="wr('١')" alt="">
 <area shape="rect" coords="65,4,92,32" onclick="wr('٢')" alt="">
 <area shape="rect" coords="92,4,122,32" onclick="wr('٣')" alt="">
 <area shape="rect" coords="123,4,151,32" onclick="wr('٤')" alt="">
 <area shape="rect" coords="151,4,180,32" onclick="wr('٥')" alt="">
 <area shape="rect" coords="179,4,210,32" onclick="wr('٦')" alt="">
 <area shape="rect" coords="210,4,238,32" onclick="wr('٧')" alt="">
 <area shape="rect" coords="238,4,268,32" onclick="wr('٨')" alt="">
 <area shape="rect" coords="268,4,296,32" onclick="wr('٩')" alt="">
 <area shape="rect" coords="296,4,326,32" onclick="wr('٠')" alt="">
 <area shape="rect" coords="326,4,355,32" onclick="wr('~')" alt="">
 <area shape="rect" coords="355,4,382,32" onclick="wr('!')" alt="">
 <area shape="rect" coords="384,4,443,32" onclick="op('back')">
     
 <area shape="rect" coords="50,33,79,61" onclick="wr('ض')" alt="">
 <area shape="rect" coords="80,33,108,61" onclick="wr('ص')" alt="">
 <area shape="rect" coords="108,33,137,61" onclick="wr('ث')" alt="">
 <area shape="rect" coords="138,34,166,61" onclick="wr('ق')" alt="">
 <area shape="rect" coords="167,34,194,62" onclick="wr('ف')" alt="">
 <area shape="rect" coords="196,34,224,61" onclick="wr('غ')" alt="">
 <area shape="rect" coords="225,34,252,62" onclick="wr('ع')" alt="">
 <area shape="rect" coords="253,34,281,61" onclick="wr('ه')" alt="">
 <area shape="rect" coords="282,33,311,61" onclick="wr('خ')" alt="">
 <area shape="rect" coords="312,33,340,60" onclick="wr('ح')" alt="">
 <area shape="rect" coords="342,33,368,60" onclick="wr('ج')" alt="">
 <area shape="rect" coords="369,33,397,60" onclick="wr('د')" alt="">
 <area shape="poly" coords="440,36,441,37,401,35,400,63,379,64,380,89,440,89" onclick="wr('\n')" alt="">
     
 <area shape="rect" coords="6,64,57,92">       
 <area shape="rect" coords="58,62,87,91" onclick="wr('ش')" alt="">
 <area shape="rect" coords="88,62,116,92" onclick="wr('س')" alt="">
 <area shape="rect" coords="117,62,145,90" onclick="wr('ي')" alt="">
 <area shape="rect" coords="146,62,174,92" onclick="wr('ب')" alt="">
 <area shape="rect" coords="175,62,203,91" onclick="wr('ل')" alt="">
 <area shape="rect" coords="204,63,232,92" onclick="wr('ا')" alt="">
 <area shape="rect" coords="233,63,261,92" onclick="wr('ت')" alt="">
 <area shape="rect" coords="262,63,290,92" onclick="wr('ن')" alt="">
 <area shape="rect" coords="291,63,319,92" onclick="wr('م')" alt="">
 <area shape="rect" coords="320,62,348,91" onclick="wr('ك')" alt="">
 <area shape="rect" coords="349,62,377,91" onclick="wr('ط')" alt="">
     
 <area shape="rect" coords="7,92,71,120">
 <area shape="rect" coords="71,92,100,120" onclick="wr('ئ')" alt="">
 <area shape="rect" coords="100,92,129,120" onclick="wr('ء')" alt="">
 <area shape="rect" coords="129,92,158,120" onclick="wr('ؤ')" alt="">
 <area shape="rect" coords="159,92,188,120" onclick="wr('ر')" alt="">
 <area shape="rect" coords="188,92,217,120" onclick="wr('لا')" alt="">
 <area shape="rect" coords="217,92,246,120" onclick="wr('ى')" alt="">
 <area shape="rect" coords="246,91,275,119" onclick="wr('ة')" alt="">
 <area shape="rect" coords="275,91,304,119" onclick="wr('و')" alt="">
 <area shape="rect" coords="304,91,333,119" onclick="wr('ز')" alt="">
 <area shape="rect" coords="333,92,362,120" onclick="wr('ظ')" alt="">
 <area shape="rect" coords="362,92,412,120">
 <area shape="rect" coords="413,92,442,120" onclick="wr('ـ')" alt="taṭwīl" title="taṭwīl (kashīda)">
     
 <area shape="rect" coords="115,121,295,149" onclick="wr(' ')" alt="">
 <area shape="rect" coords="408,121,440,145" onclick="sl('area').select()" alt="Text Highlight">
</map>

</body>
</html>

<script>
  /*document.getElementById("area").addEventListener('copy', function(e) {
    // This is necessary to prevent the current document selection from
    // being written to the clipboard.
    console.log("preventing direct copy");
    e.preventDefault();
    copy2Clipboard();
  });
  */
 
  function copy2Clipboard() {
    /* Get the text field */
    var copyText = document.getElementById("area");
    var original_copyText = copyText.value; 
    /* remove the special characters: */
    var temp_copyText = copyText.value.split("\u25CC").join("");
    var temp_copyText = temp_copyText.split("\u200A").join("");
    var temp_copyText = temp_copyText.split("\u061C").join("");
    /* Put the manipulated text back into the text field*/
    copyText.value = temp_copyText;
    /* Select the text field */
    copyText.select();
    /* Copy the text inside the text field */
    document.execCommand("copy");
    /* Alert the copied text */
    alert("Copied the text: " + copyText.value);
    /* Put the original copyText back in */
    copyText.value = original_copyText;
  }
  
  

  
  /*
  function buttonwr(id) {
    var inp = document.getElementById(id).value;    
    wr(inp);
  }
  

  function addNewInput(){
    var moreInputsDiv = document.getElementById("moreInputs");
    var inputs = moreInputsDiv.getElementsByTagName("input");
    var len = inputs.length
    var div = document.createElement("div");
    document.getElementById("moreInputs").appendChild(div);
    var inp = document.createElement("input");
    inp.className = "extraInput";
    inp.setAttribute("type", "text");
    inp.setAttribute("id", "extraInput"+len);
    div.appendChild(inp);
    var inp2 = document.createElement("input");
    inp2.className = "extraInputDescr";
    inp2.setAttribute("type", "text");
    inp2.setAttribute("value", "descr");
    div.appendChild(inp2);
    var b = document.createElement("button");
    b.className = "l-btn";
    b.setAttribute("id", "extraBtn"+len);
    b.setAttribute("onclick", "buttonwr('extraInput"+len+"')");
    b.innerHTML="insert";
    div.appendChild(b);
  }
  */
  function insertALM () {
      /* ALM = Arabic letter mark, U+061C, "a non-printing character used in the 
      computerized typesetting of bi-directional text containing mixed 
      left-to-right scripts and right-to-left scripts. 
      Similar to Right-to-left mark (RLM), it is used to change the way 
      adjacent characters are grouped with respect to text direction" */
      var keyID = event.which;
      console.log(keyID);
      var ignoreArray = [37, 38, 39, 40, /*arrow buttons*/
                         35, 36, /*home and end*/
                         8, 48, /*del and backspace*/
                         17, 18, /*alt and ctrl*/ 
                         20, 16, /*caps lock and shift*/
                         ];
      if (ignoreArray.includes(keyID)) {
          console.log("keyID "+keyID+". Do not do anything");
      }  else if (keyID === 67) { /* if C key is pressed:*/
          if (event.ctrlKey) {  /* check if ctrl is also pressed; if so, copy*/
            copy2Clipboard();
          } else {
            wr("");
          }
      } else {
          wr("");
      }
      /*switchEscapes();*/
  }
  
  /* The following function, meant to display \b instead of b\ etc.
  does not work...
  function switchEscapes() {
      var input = document.getElementById("area");
      var s = input.value;
      var r = s.replace(/\\([bBnNtTwWdDrR.])/g, /\1\\/);
      console.log(r);
      input.value = r;
      input.focus();
      if (input.setSelectionRange) {
          var srt = input.selectionStart;
          var len = input.selectionEnd;
          if (srt < len) srt++;
          input.value = input.value.substr(0, srt) + "" + input.value.substr(len);
          input.setSelectionRange(srt, srt);
      } else {
          var range = document.selection.createRange();
          range.text = "";
      }
      input.focus();
      input.scrollTop = input.scrollHeight;
  }*/
  
    populateInitialKeys()
    function populateInitialKeys() {
        var initial = [
          ['\u25ccْ',"sukūn"], 
          ['\u25ccّ', "shadda"],
          ['\u25ccَ', "fatḥa"],
          ['\u25ccُ', "ḍamma"],
          ['\u25ccِ',"kasra"], 
          ['\u25ccً', "fatḥatān"],
          ['\u25ccٌ',"ḍammatān"],
          ['\u25ccٍ', "kasratān"], 
          ['\u25cc\u06e1',"Quranic sukun"],
          ['\u25cc\u08f0',"Quranic open fatḥatān"],
          ['\u25cc\u08f1',"Quranic open ḍammatān"],
          ['\u25cc\u08f2',"Quranic open kasratān"],
          ['\u25ccٰ',"dagger alif"],  
          ['',""],
          ['آ', "alif madda"],
          ['ٱ', "alif waṣla"],
          ['أ', "alif with hamza on top"],
          ['إ', "alif with hamza below"],
          ['ٮ',"dotless b"],
          ['ں',"dotless n"],
          ['ڡ',"dotless f"],
          ['ٯ',"dotless q"],
          ['ڧ',"maghrebi q"],
          ['ڢ',"maghrebi f"], 
          ['ک',"final kāf"],
          ['',""],
          ['',""],
          ['',""],
          ['،', "Arabic comma"], 
          [':', "colon"], 
          ['؛', "Arabic semicolon"], 
          ['؟', "Arabic question mark"], 
          ['.', "full stop"], 
          ['[', "opening bracket"], 
          [']', "closing bracket"], 
          ['(', "opening square bracket"], 
          [')', "closing square bracket"], 
          ['{‎', "opening curly bracket"], 
          ['}‎', "closing curly bracket"], 
        ];
      for (i=0; i<initial.length; i++) {
          addKey(initial[i][0], initial[i][1]);
      }
    }
    function addRowBgd(lastRow) {
       /*Add background image: row of empty keys*/
       var bgdDiv = document.createElement("div");
       bgdDiv.className = "rowBgd";
       lastRow.appendChild(bgdDiv);
       var img = document.createElement("img");
       img.src = "i/emptyKeyRow_45x450.png";
       img.setAttribute("width", "450px");
       img.setAttribute("height", "45px");
       bgdDiv.appendChild(img);

       /*Add second version of background image, fully transparent*/
       var mappedDiv = document.createElement("div");
       mappedDiv.className = "rowMapped";
       lastRow.appendChild(mappedDiv);
       var img = document.createElement("img");
       img.src = "i/emptyKeyRow_45x450.png";
       img.setAttribute("width", "450px");
       img.setAttribute("height", "45px");
       img.setAttribute("usemap", "#map_"+lastRow.id);
       mappedDiv.appendChild(img);


       /*Add the grid div that will contain the characters: */
       var keyGridDiv = document.createElement("div");
       keyGridDiv.setAttribute("class", "keyGrid");
       lastRow.appendChild(keyGridDiv);
       /*create a new map element*/
       var newMap = document.createElement("map");
       newMap.setAttribute("name", ("map_"+lastRow.id));
       newMap.setAttribute("id", ("map_"+lastRow.id));
       document.getElementsByTagName("body")[0].appendChild(newMap);

       /*for the row with the vowels, add an alternative mapping: */
       if (lastRow.id === "extraRow0") {
           var newMap = document.createElement("map");
           newMap.setAttribute("name", ("alt_map_"+lastRow.id));
           newMap.setAttribute("id", ("alt_map_"+lastRow.id));
           document.getElementsByTagName("body")[0].appendChild(newMap);
           img.setAttribute("usemap", "#alt_map_"+lastRow.id);
           var regexCheckbox0 = document.getElementById("regexCheck0");
           regexCheckbox0.addEventListener( 'change', function() {
             if(this.checked) {
                 img.setAttribute("usemap", "#map_"+lastRow.id);
             } else {
                 img.setAttribute("usemap", "#alt_map_"+lastRow.id);
             }
           });
       }
    }
    function addKey(character, alias) {
       if (character === "none") {
           var character = document.getElementById("extraInput0").value;
           var alias = document.getElementById("extraInputDescr0").value;
       }
       var xtra = document.getElementById("extraRows");
       var rowList = xtra.getElementsByClassName("extraRow");
       var keyList = rowList[rowList.length - 1].getElementsByClassName("keyCharacter"); 
       console.log("keyList:", keyList.length);
       var lastRow = document.getElementById(rowList[rowList.length - 1].id);
       console.log("lastRow:", lastRow);
       console.log("keyList.length:", keyList.length);
       
       if (keyList.length === 0) {
           addRowBgd(lastRow);
       } else if (keyList.length === 14) {
           console.log("add new row!");
           var rowDiv = document.createElement("div");
           rowDiv.className = "extraRow";
           rowDiv.setAttribute("id", "extraRow" + rowList.length);
           console.log("extraRow" + rowList.length);
           xtra.appendChild(rowDiv);
           addRowBgd(rowDiv);
           var rowList = xtra.getElementsByClassName("extraRow");
           var lastRow = document.getElementById(rowList[rowList.length - 1].id);
           var keyList = rowList[rowList.length - 1].getElementsByClassName("keyCharacter");
       }
       /*Add the character to the grid: */
       var keyCharacterDiv = document.createElement("div");
       keyCharacterDiv.innerHTML = character;
       keyCharacterDiv.setAttribute("class", "keyCharacter");
       lastRow.getElementsByClassName("keyGrid")[0].appendChild(keyCharacterDiv);
       
       /* Add the new key to the current image map: */
       var currentMap = document.getElementById("map_"+lastRow.id); 
       var coord1_X = 11 + ((keyList.length - 1)*30);
       var coord2_X = 11 + ((keyList.length)*30);
       var area = document.createElement("area");
       area.setAttribute("shape", "rect");
       area.setAttribute("coords", coord1_X+",6,"+coord2_X+",41");
       console.log("coords", coord1_X+",6,"+coord2_X+",41");
       area.setAttribute("onclick", "wr('" + character + "')");
       area.setAttribute("alt", alias);
       area.setAttribute("title", alias);
       currentMap.appendChild(area);
       /*for the row with the vowels, add an alternative mapping*/
       if (rowList.length === 1) {
           var currentMap = document.getElementById("alt_map_"+lastRow.id); 
           var coord1_X = 11 + ((keyList.length - 1)*30);
           var coord2_X = 11 + ((keyList.length)*30);
           var area = document.createElement("area");
           area.setAttribute("shape", "rect");
           area.setAttribute("coords", coord1_X+",6,"+coord2_X+",41");
           console.log("coords", coord1_X+",6,"+coord2_X+",41");
           area.setAttribute("onclick", "wr('" + character[1] + "')");
           area.setAttribute("alt", alias);
           area.setAttribute("title", alias);
           currentMap.appendChild(area);
       }
       
       
    }
    function Toggle(id){
       var el = document.getElementById(id);
       if (el.style.display === "block"){
           el.style.display = "none";
           console.log("none");
       } else {
           el.style.display = "block";
           console.log("block");
       }
    }
  
</script>
